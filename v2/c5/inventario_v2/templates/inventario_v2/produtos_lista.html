{% extends "inventario_v2/base.html" %}
{% block title %}Lista de Produtos{% endblock %}
{% block content %}
  <section class="panel">
    <div class="panel-header">
      <h1>Produtos</h1>
      <div class="panel-actions">
        <form class="search-form" method="get">
          <input name="q" type="search" placeholder="Buscar por nome…" value="{{ request.GET.q }}">
          {% if tabelas %}
            <select name="tabela">
              <option value="">Todas tabelas</option>
              {% for t in tabelas %}
                <option value="{{ t.id }}" {% if request.GET.tabela == t.id|stringformat:"s" %}selected{% endif %}>{{ t.nome }}</option>
              {% endfor %}
            </select>
          {% endif %}
          <button class="btn" type="submit">Buscar</button>
        </form>
        <a class="btn primary" href="{% url 'inventario_v2:produtos_adicionar' %}">Adicionar produto</a>
      </div>
    </div>

    <div class="table-wrap">
      <table class="styled-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Tabela</th>
            <th>Quantidade</th>
            <th>Preço</th>
            <th class="actions-col">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for p in produtos %}
            <tr>
              <td>{{ p.nome }}</td>
              <td>
                {% if p.tabela %}
                  {{ p.tabela.nome }}
                {% else %}
                  —
                {% endif %}
              </td>
              <td class="center">{{ p.quantidade }}</td>
              <td class="right">R$ {{ p.preco }}</td>
              <td class="actions-col">
                <a class="link" href="{% url 'inventario_v2:produtos_editar' p.pk %}">Editar</a>
                <span class="sep">|</span>
                <a class="link danger" href="{% url 'inventario_v2:produtos_remover' p.pk %}">Excluir</a>
                <span class="sep">|</span>
                <a class="link" href="{% url 'inventario_v2:produto_movimentacoes' produto_pk=p.pk %}">Histórico</a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5" class="empty">Nenhum produto encontrado.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if is_paginated %}
      <nav class="pagination">
        {% if page_obj.has_previous %}
          <a class="btn subtle" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.tabela %}&tabela={{ request.GET.tabela }}{% endif %}">Anterior</a>
        {% endif %}
        <span class="page-info">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
          <a class="btn subtle" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.tabela %}&tabela={{ request.GET.tabela }}{% endif %}">Próxima</a>
        {% endif %}
      </nav>
    {% endif %}
  </section>
{% endblock %}