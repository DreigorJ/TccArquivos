{% extends "inventario_v1/base.html" %}
{% block title %}Produtos{% endblock %}
{% block content %}
<section class="panel">
  <div class="panel-header">
    <h1>Produtos</h1>
    <div class="panel-actions">
      <form class="search-form" method="get">
        <input type="text" name="q" placeholder="Pesquisar..." value="{{ request.GET.q|default:'' }}">
        <select name="categoria">
          <option value="">Todas as categorias</option>
          {% comment %}Se desejar mais robustez, passe 'categorias' no contexto da view{% endcomment %}
          {% for cat in Categoria.objects.all %}
            <option value="{{ cat.pk }}" {% if request.GET.categoria|stringformat:"s" == cat.pk|stringformat:"s" %}selected{% endif %}>{{ cat.nome }}</option>
          {% endfor %}
        </select>
        <button class="btn" type="submit">Filtrar</button>
      </form>
      <div>
        <a class="btn" href="{% url 'inventario_v1:produtos_adicionar' %}">Adicionar produto</a>
        <a class="btn" href="{% url 'inventario_v1:movimentacoes_adicionar' %}">Nova movimentação</a>
      </div>
    </div>
  </div>

  <div class="table-wrap">
    <table class="styled-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Quantidade</th>
          <th>Preço</th>
          <th>Categoria</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for produto in produtos %}
        <tr>
          <td><a href="{% url 'inventario_v1:produtos_descricao' produto.pk %}">{{ produto.nome }}</a></td>
          <td class="center">{{ produto.quantidade }}</td>
          <td class="mono">{{ produto.preco }}</td>
          <td>{% if produto.categoria %}{{ produto.categoria.nome }}{% else %}—{% endif %}</td>
          <td class="actions-col">
            <a class="link" href="{% url 'inventario_v1:produtos_editar' produto.pk %}">Editar</a>
            <a class="link" href="{% url 'inventario_v1:produtos_remover' produto.pk %}">Remover</a>
            <a class="link" href="{% url 'inventario_v1:movimentacoes_adicionar' %}?produto={{ produto.pk }}">Movimentar</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="empty">Nenhum produto cadastrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}